#!/bin/bash

echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º –¥–µ–ø–ª–æ–π –Ω–∞ Time.web Cloud Server..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
if [ ! -f "package.json" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: package.json –Ω–µ –Ω–∞–π–¥–µ–Ω. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞."
    exit 1
fi

# –°–æ–∑–¥–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é —Ç–µ–∫—É—â–µ–≥–æ package.json
echo "üìã –°–æ–∑–¥–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é package.json..."
cp package.json package.json.backup

# –ó–∞–º–µ–Ω—è–µ–º package.json –Ω–∞ –≤–µ—Ä—Å–∏—é –¥–ª—è Time.web
echo "üîÑ –ó–∞–º–µ–Ω—è–µ–º package.json –Ω–∞ –≤–µ—Ä—Å–∏—é –¥–ª—è Time.web..."
cp package-timeweb.json package.json

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
echo "üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏..."
npm install

# –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–µ–∫—Ç
echo "üî® –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–µ–∫—Ç..."
npm run build

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–±–æ—Ä–∫–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ
if [ ! -d "build" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –ø–∞–ø–∫–∞ build –Ω–µ —Å–æ–∑–¥–∞–Ω–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—à–∏–±–∫–∏ —Å–±–æ—Ä–∫–∏."
    # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π package.json
    cp package.json.backup package.json
    exit 1
fi

echo "‚úÖ –°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!"

# –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π package.json
echo "üîÑ –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π package.json..."
cp package.json.backup package.json

echo ""
echo "üìÅ –§–∞–π–ª—ã –≥–æ—Ç–æ–≤—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤ –ø–∞–ø–∫–µ 'build/'"
echo ""
echo "üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è –æ–±–ª–∞—á–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞:"
echo ""
echo "1Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ –æ–±–ª–∞—á–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞:"
echo "   - –í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç Time.web"
echo "   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ '–û–±–ª–∞—á–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã'"
echo "   - –°–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä–≤–µ—Ä —Å Ubuntu 22.04"
echo ""
echo "2Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞:"
echo "   - –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –ø–æ SSH: ssh root@–≤–∞—à_ip"
echo "   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Nginx: apt install nginx -y"
echo "   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Node.js: curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash - && apt install nodejs -y"
echo ""
echo "3Ô∏è‚É£ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤:"
echo "   - –ß–µ—Ä–µ–∑ SCP: scp -r build/* root@–≤–∞—à_ip:/var/www/menu/"
echo "   - –ò–ª–∏ —á–µ—Ä–µ–∑ SFTP –∫–ª–∏–µ–Ω—Ç (FileZilla, WinSCP)"
echo ""
echo "4Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–º–µ–Ω–∞:"
echo "   - –î–æ–±–∞–≤—å—Ç–µ –¥–æ–º–µ–Ω –≤ –ø–∞–Ω–µ–ª–∏ Time.web"
echo "   - –£–∫–∞–∂–∏—Ç–µ IP —Å–µ—Ä–≤–µ—Ä–∞ –≤ DNS"
echo "   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSL: certbot --nginx -d –≤–∞—à_–¥–æ–º–µ–Ω.com"
echo ""
echo "üåê –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:"
echo "- –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ª–∏ –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞"
echo "- –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ /admin"
echo "- –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è"
echo ""
echo "üéâ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω!"
